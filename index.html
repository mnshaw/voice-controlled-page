
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Example of Speech Recognition</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>

var potentialcommand = "";

$(document).ready(function() {
  try {
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    var recognition = new SpeechRecognition();
    console.log("recognition exists");
  }
  catch(e) {
    console.log("recognition doesn't exist");
    // alert("Voice recognition is not supported");
    alert(e);
    console.error(e);
    $('.no-browser-support').show();
    $('.app').hide();
  }

  var command = "";

  //-- NOTE: No use time on insertChat.
  recognition.onresult = function(event) {
    console.log("onresult");
    // event is a SpeechRecognitionEvent object.
    // It holds all the lines we have captured so far. 
    // We only need the current one.
    var current = event.resultIndex;

    // Get a transcript of what was said.
    var transcript = event.results[current][0].transcript;

    // Add the current transcript to the contents of our Note.
    // There is a weird bug on mobile, where everything is repeated twice.
    // There is no official solution so far so we have to handle an edge case.
    var mobileRepeatBug = (current == 1 && transcript == event.results[0][0].transcript);

    if(!mobileRepeatBug) {
      command += transcript;
    }
    console.log(command);

    if (deviceResponse != "") {
      potentialcommand = command;
      $("#command").val() = potentialcommand;
    } 
  };


  recognition.onstart = function() { 
    console.log("onstart");
    // console.log('Voice recognition activated. Try speaking into the microphone.');
  }

  recognition.onspeechend = function() {
    console.log("onspeechend");
    
    command = "";
    // console.log('You were quiet for a while so voice recognition turned itself off.');
  }

  recognition.onerror = function(event) {
    console.log("onerror")
    alert(event.error);
    if(event.error == 'no-speech') {
      console.log('No speech was detected. Try again.');  
    };
  }


  $("#commandbutton").click(function() {
    recognition.start();

    console.log(potentialcommand);

    var re = /^(click|scroll|enter)\s(.*)/i;
    var result = re.exec(potentialcommand);

    if(result) {
      var verb = result[1];
      var arg = result[2]

      console.log("verb: " + verb + ", args: " + arg)

      switch(verb) {
        case "click":
          // what do we do if click?
          console.log("handling click")

          //console.log($("*:contains('" + arg + "')"));

          var stringpieces = arg.split(/\s/);

          $("a,input,button").each(function() {
            if($(this)[0].tagName == "INPUT") {
              console.log("This is input");
              // look for the text in INPUT fields
            } else {
              console.log("this is not input");
            }
          })

          break;
        case "scroll":
          // what do we do on scroll?
          console.log("handling scroll`")
          break;
        case "enter":
          // what do we do on enter?
          console.log("handling enter")
          break;
        default:
          console.log("sorry, that is not a recognized command")
      }


    //console.log("Scroll " + result[1]);
    //if(result[1]=="up") {
      // scroll up
    //} else if(result[1]=="down") {
      // scroll down
    //}

    }
  })
});
</script>

</head>
  <body>
    <p>
      <input type="text" id="command"><input type="button" value="Do something!" id="commandbutton">
    </p>

    <p>
    <input type="button" value="cat"><br>
    <a href="google.com">Google</a><br>
    <a href="cmu.edu">CMU</a><br>

  </body>
</html>